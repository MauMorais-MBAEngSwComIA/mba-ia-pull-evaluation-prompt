# **PRD: Sistema de Otimização e Avaliação de Prompts (LangChain/LangSmith)**

## **1\. Visão Geral**

Este projeto consiste em uma ferramenta de CLI e automação para o ciclo de vida de Prompt Engineering. O sistema deve automatizar o fluxo de: captura de prompts de baixa qualidade, otimização técnica via código, publicação em repositório centralizado e avaliação automatizada por LLM-as-a-judge.

## **2\. Objetivos e KPIs**

* **Métricas de Sucesso:** Atingir score $\\ge 0.9$ em: *Tone, Acceptance Criteria, User Story Format* e *Completeness*.
* **Automação:** Ciclo completo de Pull/Push sem necessidade de intervenção manual no Dashboard para operações de arquivo.

## **3\. Requisitos Funcionais (RF)**

### **RF01: Integração com LangSmith Prompt Hub**

* O sistema deve realizar o **Pull** de prompts específicos utilizando langchain.hub.
* O sistema deve realizar o **Push** de prompts otimizados, mantendo metadados (tags e técnicas utilizadas).

### **RF02: Pipeline de Avaliação (LLM-as-a-judge)**

* Implementar motor de avaliação em src/evaluate.py.
* Utilizar langsmith.evaluation.evaluate para rodar os datasets.
* **Métricas customizadas:** Criar lógica em src/metrics.py para avaliar a conformidade de uma User Story (Markdown, Persona, Critérios de Aceite).

### **RF03: Camada de Testes de Sanidade**

* Implementar suite de testes via **Pytest** para validar o arquivo YAML do prompt antes do push.
* **Validadores:** Checagem de System Message, Role Definition e presença de Few-shot examples.

## **4\. Requisitos Técnicos e Arquitetura**

### **4.1. Stack Tecnológica**

* **Linguagem:** Python 3.9+
* **Orquestração:** LangChain.
* **Observabilidade:** LangSmith (Tracing ativado).
* **LLMs:** Gemini 2.0 Flash (como provider principal e avaliador).

### **4.2. Estrutura de Dados (YAML)**

O prompt otimizado em bug\_to\_user\_story\_v2.yml deve seguir o esquema de ChatPromptTemplate:

YAML
`_type: "prompt"`
`template_format: "f-string"`
`input_variables: ["bug_report"]`
`messages:`
  `- role: "system"`
    `content: "..."`
  `- role: "user"`
    `content: "{bug_report}"`

## **5\. User Stories para o Protótipo**

| ID             | Ator     | Descrição                                                                                              |
| :------------- | :------- | :------------------------------------------------------------------------------------------------------- |
| **US01** | Dev      | Eu quero extrair o prompt v1 para ter uma linha de base (baseline) de performance.                       |
| **US02** | AI Agent | Eu quero aplicar CoT e Few-shot no template YAML para estruturar melhor a saída do modelo.              |
| **US03** | QA/Dev   | Eu quero rodar a avaliação e ver o tracing no LangSmith para identificar onde o modelo está falhando. |

## **6\. Riscos e Premissas**

* **Premissa:** O usuário possui LANGSMITH\_API\_KEY e GOOGLE\_API\_KEY configuradas.
* **Risco:** O custo de tokens durante as iterações de avaliação (15 exemplos por rodada).
